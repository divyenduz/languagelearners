datasource db {
  provider = "postgresql"
  url      = env("DB_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Payment {
  id                       String            @id @default(cuid())
  createdAt                DateTime          @default(now())
  updatedAt                DateTime          @default(now())
  amount                   Int
  provider_subscription_id String
  provider_payment_id      String            @unique
  subscription             SubscriptionPlan? @relation(fields: [subscriptionPlanId], references: [id])
  subscriptionPlanId       String?
  User                     User?             @relation(fields: [userId], references: [id])
  userId                   String?
}

model SubscriptionPlan {
  id                       String    @id @default(cuid())
  provider_plan_id         String
  provider_subscription_id String
  payments                 Payment[]
  users                    User[]
}

model Telemetry {
  id            String        @id @default(cuid())
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now())
  filename      String
  payload       String
  telemetry_key String
  type          TelemetryType
}

model User {
  id                   String            @id @default(cuid())
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @default(now())
  first_name           String?
  last_name            String?
  email                String?           @unique
  plan                 Plan
  provider_customer_id String?
  source_language      SourceLanguage    @default(value: EN)
  target_language      TargetLanguage    @default(value: DE)
  telegram_chat_id     String?           @unique
  telegram_id          String?           @unique
  type                 UserType          @default(value: USER)
  subscription         SubscriptionPlan? @relation(fields: [subscriptionPlanId], references: [id])
  subscriptionPlanId   String?
  payment              Payment[]
}

enum SourceLanguage {
  EN
  DE
  ES
  NL
  FR
  HI
  IT
  JP
  KR
  RU
  SE
  FA
}

enum TargetLanguage {
  EN
  DE
  ES
  NL
  FR
  HI
  IT
  JP
  KR
  RU
  SE
  FA
}

// PAST: Was a user in past but does not exist now
// GUEST: Free as a friend, we do this for feedback
// INTRO_5: People who were onboarded on introductory price of $5/month
// PLAN_9: The original $9 plan
// YEARLY_100: $100/year as discount
// LIFETIME_199: $199 and LLC is yours for life
enum Plan {
  PAST
  GUEST
  INTRO_5
  PLAN_9
  YEARLY_100
  LIFETIME_199
}

enum TelemetryType {
  PROVIDER_PAYMENT_EVENT
}

enum UserType {
  ADMIN
  USER
}
